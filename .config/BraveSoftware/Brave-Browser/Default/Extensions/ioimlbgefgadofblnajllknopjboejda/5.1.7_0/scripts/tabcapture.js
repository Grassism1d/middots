!function e(t,r,n){function i(s,c){if(!r[s]){if(!t[s]){var u="function"==typeof require&&require;if(!c&&u)return u(s,!0);if(o)return o(s,!0);var a=new Error("Cannot find module '"+s+"'");throw a.code="MODULE_NOT_FOUND",a}var p=r[s]={exports:{}};t[s][0].call(p.exports,(function(e){return i(t[s][1][e]||e)}),p,p.exports,e,t,r,n)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(e,t,r){function n(e,t,r,n,i,o,s){try{var c=e[o](s),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,i)}t.exports=function(e){return function(){var t=this,r=arguments;return new Promise((function(i,o){var s=e.apply(t,r);function c(e){n(s,i,o,c,u,"next",e)}function u(e){n(s,i,o,c,u,"throw",e)}c(void 0)}))}},t.exports.__esModule=!0,t.exports.default=t.exports},{}],2:[function(e,t,r){t.exports=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},t.exports.__esModule=!0,t.exports.default=t.exports},{}],3:[function(e,t,r){t.exports=function(e){return e&&e.__esModule?e:{default:e}},t.exports.__esModule=!0,t.exports.default=t.exports},{}],4:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=n(e("@babel/runtime/helpers/defineProperty")),o=n(e("@babel/runtime/helpers/asyncToGenerator"));function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}!function(){var e,t,r=chrome.runtime.connect({name:"transpose-controls"});function n(){return new Promise((e=>{chrome.tabCapture.capture({audio:!0,video:!1},(t=>{e(t)}))}))}function i(e){e.command,chrome.runtime.sendMessage(e,(e=>!0))}function s(){return(s=(0,o.default)((function*(){var[e]=yield chrome.tabs.query({active:!0,lastFocusedWindow:!0});if(!e)return i({sender:"tabCaptureTab",success:!1,errorMessage:"Tab connection error"}),window.close(),!1;t=e.id}))).apply(this,arguments)}function u(){return(u=(0,o.default)((function*(r){try{var o=yield n();if(o){o.oninactive=()=>{window.close()};var s=new AudioContext,u=s.createMediaStreamSource(o);e=new d(chrome.runtime.getURL(""),s,u,0,0),i({tabId:t,sender:"tabCaptureTab",success:!0})}else{var a,p={},h=(null===(a=chrome.runtime.lastError)||void 0===a?void 0:a.message)||JSON.stringify(chrome.runtime.lastError);h&&(p.errorMessage=h),i(c({tabId:t,sender:"tabCaptureTab",success:!1},p)),setTimeout((()=>{window.close()}),100)}}catch(e){var l,f={},m=(null===(l=chrome.runtime.lastError)||void 0===l?void 0:l.message)||JSON.stringify(chrome.runtime.lastError);m&&(f.errorMessage=m),i(c({tabId:t,sender:"tabCaptureTab",success:!1},f)),setTimeout((()=>{window.close()}),100)}}))).apply(this,arguments)}function a(){return(a=(0,o.default)((function*(e){try{"transpose-controls-tabcapture"===e.name&&(yield e.onMessage.addListener((e=>p(e))))}catch(e){}}))).apply(this,arguments)}function p(e){return h.apply(this,arguments)}function h(){return(h=(0,o.default)((function*(r){try{"pitchShift"===r.command&&r.tabId===t&&(void 0!==r.semiTone&&e.setPitchTranspose(e.pitch,r.semiTone),void 0!==r.pitch&&e.setPitchTranspose(r.pitch,e.semitone)),"exit-tabCapture"===r.command&&r.tabId===t&&window.close()}catch(e){}}))).apply(this,arguments)}document.querySelector("#exitButton").addEventListener("click",(e=>{r.postMessage({command:"exit-tabCapture",tabId:t}),chrome.tabs.sendMessage(t,{command:"exit-tabCapture"}),window.close()})),function(){s.apply(this,arguments)}(),function(e){u.apply(this,arguments)}(),chrome.runtime.onConnect.addListener((e=>function(e){return a.apply(this,arguments)}(e)));var d=function(e,t,r,n,i){this.pitch=n,this.semitone=i,this.input,this.context=t,this.source=r;var o=e+"scripts/audioworklet-pitch-hq-processor.js";this.context.audioWorklet.addModule(o).then((()=>{this.input=new AudioWorkletNode(this.context,"audioworklet-pitch-hq-processor",{channelCount:2,channelCountMode:"clamped-max"}),this.source.connect(this.input).connect(this.context.destination),this.setPitchTranspose(this.pitch,this.semitone)})),this.stop=function(){this.disconnect(),this.source.disconnect(),this.source.mediaStream.getAudioTracks()[0].stop()},this.disconnect=function(){this.input&&this.input.disconnect(),this.source&&(this.source.disconnect(),this.source.connect(this.context.destination))},this.setPitchTranspose=function(e,t){this.pitch=e,this.semitone=t,this.input&&((0===this.pitch||this.pitch)&&(this.input.parameters.get("pitch").value=this.pitch),(0===this.semitone||this.semitone)&&(this.input.parameters.get("semitone").value=this.semitone))}}}()},{"@babel/runtime/helpers/asyncToGenerator":1,"@babel/runtime/helpers/defineProperty":2,"@babel/runtime/helpers/interopRequireDefault":3}]},{},[4]);